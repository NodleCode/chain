<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Run the provided non-terminating computation on an entirely new stack."><meta name="keywords" content="rust, rustlang, rust-lang, replace_stack"><title>replace_stack in psm - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../psm/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><div class="sidebar-elems"><h2 class="location">Other items in<br><a href="index.html">psm</a></h2><div id="sidebar-vars" data-name="replace_stack" data-ty="fn" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Function <a href="index.html">psm</a>::<wbr><a class="fn" href="#">replace_stack</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/psm/lib.rs.html#253-270" title="goto source code">[src]</a></span></h1><pre class="rust fn"><code>pub unsafe fn replace_stack&lt;F:&nbsp;<a class="trait" href="https://doc.rust-lang.org/1.56.1/core/ops/function/trait.FnOnce.html" title="trait core::ops::function::FnOnce">FnOnce</a>()&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;base: *mut u8, <br>&nbsp;&nbsp;&nbsp;&nbsp;size: usize, <br>&nbsp;&nbsp;&nbsp;&nbsp;callback: F<br>) -&gt; !</code></pre><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Run the provided non-terminating computation on an entirely new stack.</p>
<p><code>base</code> address must be the low address of the stack memory region, regardless of the stack
growth direction. It is not necessary for the whole region <code>[base; base + size]</code> to be usable
at the time this function called, however it is required that at least the following hold:</p>
<ul>
<li>Both <code>base</code> and <code>base + size</code> are aligned up to the target-specific requirements;</li>
<li>Depending on <code>StackDirection</code> value for the platform, the end of the stack memory region,
which would end up containing the first frame(s), must have sufficient number of pages
allocated to execute code until more pages are commited. The other end should contain a guard
page (not writable, readable or executable) to ensure Rust’s soundness guarantees.</li>
</ul>
<p>Note, that some or all of these considerations are irrelevant to some applications. For
example, Rust’s soundness story relies on all stacks having a guard-page, however if the user
is able to guarantee that the memory region used for stack cannot be exceeded, a guard page may
end up being an expensive unnecessity.</p>
<p>The previous stack is not deallocated and may not be deallocated unless the data on the old
stack is not referenced in any way (by e.g. the <code>callback</code> closure).</p>
<p>On platforms where multiple stack pointers are available, the “current” stack pointer is
replaced.</p>
<h1 id="guidelines" class="section-header"><a href="#guidelines">Guidelines</a></h1>
<p>Memory regions that are aligned to a single page (usually 4kB) are an extremely portable choice
for stacks.</p>
<p>Allocate at least 4kB of stack. Some architectures (such as SPARC) consume stack memory
significantly faster compared to the more usual architectures such as x86 or ARM. Allocating
less than 4kB of memory may make it impossible to commit more pages without overflowing the
stack later on.</p>
<h1 id="unsafety" class="section-header"><a href="#unsafety">Unsafety</a></h1>
<p>The stack <code>base</code> address must be aligned as appropriate for the target.</p>
<p>The stack <code>size</code> must be a multiple of stack alignment required by target.</p>
<p>The <code>size</code> must not overflow <code>isize</code>.</p>
<p><code>callback</code> must not return (not enforced by typesystem currently because <code>!</code> is unstable),
unwind or otherwise return control flow to any of the previous frames.</p>
</div></details></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="psm" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script>
</body></html>